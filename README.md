[![License](http://img.shields.io/:license-Apache_v2-blue.svg)](https://github.com/maropu/scavenger/blob/master/LICENSE)

This is an experimental prototype to rummage integrity constraints in Spark catalog tables.
Since Spark does not provide any functionality for
[informational referential integrity constraints](https://issues.apache.org/jira/browse/SPARK-19842) now,
this plugin intends to make users understand defined tables easily in Spark.
To visualize inferred constraints, this plugin generates metadata and
entity-relation diagrams with constraints by [SchemaSpy](http://schemaspy.org/).

***NOTE: This work is in progress, so it only implements simple inferences for foreign-key constraints.***

## How to try this plugin

    # This repository includes a simple wrapper script `bin/python` to create
    # a virtual environment to resolve the required dependencies (e.g., Python 3.6 and PySpark 2.4),
    # then launch a Python VM with this plugin.
    $ ./bin/python

    # Loads CSV data and defines tables in a catalog
    >>> factTable = spark.read.option('header', True).option('inferSchema', True).csv("./testdata/factTable.csv")
    >>> factTable.write.saveAsTable('factTable')
    >>> dim1 = spark.read.option('header', True).option('inferSchema', True).csv("./testdata/dim1.csv")
    >>> dim1.write.saveAsTable('dim1')
    >>> dim2 = spark.read.option('header', True).option('inferSchema', True).csv("./testdata/dim2.csv")
    >>> dim2.write.saveAsTable('dim2')
    >>> dim3 = spark.read.option('header', True).option('inferSchema', True).csv("./testdata/dim3.csv")
    >>> dim3.write.saveAsTable('dim3')

    # Infers foreign-key constraings and entity-relation diagrams generated by SchemaSpy
    >>> schemaSpyResult = scavenger.setDbName('default').infer()
    >>> schemaSpyResult.show()

<img src="resources/schemaspy.png" width="450px">

## References for Future Work

 - Eduardo H. M. Pena, Eduardo C. de Almeida, and Felix Naumann, Discovery of Approximate (and Exact) Denial Constraints, Proceedings of the VLDB Endowment , 13(3), p266-278, 2019.
 - Thorsten Papenbrock and Felix Naumann, A Hybrid Approach to Functional Dependency Discovery, Proceedings of SIGMOD'16, p821-833, 2016.
 - Z. Abedjan, L. Golab, and F. Naumann, Profiling Relational Data: A Survey, VLDB Journal, 24(4), p557â€“581, 2015.

